<?xml version="1.0" encoding="utf-8"?>
<winex:WindowEx
    x:Class="OpenClawTray.Windows.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:winex="using:WinUIEx"
    Title="设置 — OpenClaw 托盘"
    MinWidth="400" MinHeight="500">

    <Window.SystemBackdrop>
        <MicaBackdrop/>
    </Window.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Scrollable content -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="24,24,24,12">
            <StackPanel Spacing="24" MaxWidth="450">

                <!-- Connection Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="连接" Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="#E74C3C" FontWeight="Bold"/>

                    <TextBox x:Name="GatewayUrlTextBox" Header="网关 URL"
                             PlaceholderText="ws://localhost:18789 或 https://host.tailnet.ts.net"/>

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBox x:Name="TokenTextBox" Header="令牌"
                                 PlaceholderText="你的 API 令牌" Width="300"/>
                        <Button x:Name="TestConnectionButton" Content="测试"
                                VerticalAlignment="Bottom" Click="OnTestConnection"/>
                    </StackPanel>

                    <TextBlock x:Name="StatusLabel" Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>

                <!-- Startup Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="启动" Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="#E74C3C" FontWeight="Bold"/>

                    <ToggleSwitch x:Name="AutoStartToggle" Header="随 Windows 自动启动"/>
                    <ToggleSwitch x:Name="GlobalHotkeyToggle" Header="全局热键 (Ctrl+Alt+Shift+C → 快速发送)"/>
                </StackPanel>

                <!-- Notifications Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="通知" Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="#E74C3C" FontWeight="Bold"/>

                    <ToggleSwitch x:Name="NotificationsToggle" Header="显示通知"/>

                    <ComboBox x:Name="NotificationSoundComboBox" Header="声音" Width="200">
                        <ComboBoxItem Content="默认"/>
                        <ComboBoxItem Content="无"/>
                        <ComboBoxItem Content="轻微"/>
                    </ComboBox>

                    <TextBlock Text="显示以下通知：" Margin="0,8,0,0"/>
                    <TextBlock Text="根据消息中的关键词过滤（例如：'邮件'、'提醒'）"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,0,0,4"/>

                    <StackPanel Spacing="4">
                        <CheckBox x:Name="NotifyHealthCb" Content="健康警报"/>
                        <CheckBox x:Name="NotifyUrgentCb" Content="紧急消息"/>
                        <CheckBox x:Name="NotifyReminderCb" Content="提醒"/>
                        <CheckBox x:Name="NotifyEmailCb" Content="邮件摘要"/>
                        <CheckBox x:Name="NotifyCalendarCb" Content="日历事件"/>
                        <CheckBox x:Name="NotifyBuildCb" Content="构建通知"/>
                        <CheckBox x:Name="NotifyStockCb" Content="库存警报"/>
                        <CheckBox x:Name="NotifyInfoCb" Content="信息消息"/>
                    </StackPanel>
                </StackPanel>

                <!-- Test Notification -->
                <Button x:Name="TestNotificationButton" Content="发送测试通知"
                        Click="OnTestNotification"/>

                <!-- Advanced Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="高级（实验性）" Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="#E74C3C" FontWeight="Bold"/>

                    <ToggleSwitch x:Name="NodeModeToggle" Header="启用节点模式"/>
                    <TextBlock Text="启用后，此电脑可以接收来自 agent 的命令（画布、截图等）"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextWrapping="Wrap"
                               Margin="0,-4,0,0"/>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- Fixed footer with buttons -->
        <Border Grid.Row="1"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button Content="取消" Click="OnCancel" Width="80"/>
                <Button x:Name="SaveButton" Content="保存"
                        Click="OnSave" Width="80" Style="{ThemeResource AccentButtonStyle}"/>
            </StackPanel>
        </Border>
    </Grid>
</winex:WindowEx>
